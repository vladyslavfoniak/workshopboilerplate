/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as g,jsx as s}from"@dropins/tools/preact-jsx-runtime.js";import{W as b}from"../chunks/ConditionalWrapper.js";/* empty css                  */import{Skeleton as A,SkeletonRow as I,Button as x}from"@dropins/tools/components.js";import{classes as z,Slot as W}from"@dropins/tools/lib.js";import{I as D,U as V,h as K,s as U}from"../chunks/fetch-graphql.js";import{events as u}from"@dropins/tools/event-bus.js";import{g as H}from"../chunks/events.js";import{g as k}from"../chunks/values.js";import{useState as C,useCallback as m,useEffect as f}from"@dropins/tools/preact-hooks.js";import{useText as L}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";var p=(e=>(e.INVALID_INPUT="INVALID_INPUT",e.SERVER_ERROR="SERVER_ERROR",e.UNAUTHENTICATED="UNAUTHENTICATED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e))(p||{});const j=["PlaceOrderError"],v=[{code:"INVALID_INPUT",matches:e=>e instanceof D},{code:"UNAUTHENTICATED",matches:e=>e instanceof V},{code:"SERVER_ERROR",matches:e=>!e||typeof e!="object"||!("name"in e)?!1:j.includes(e.name)}];function B(e){const o=v.find(n=>n.matches(e));return o?o.code:p.UNKNOWN_ERROR}const q=()=>g(A,{"data-testid":"place-order-skeleton",children:[s(I,{size:"small",variant:"empty"}),s(I,{size:"small"})]}),w=({children:e,className:o,disabled:n=!1,onClick:i})=>s("div",{className:z(["checkout-place-order",o]),children:s(x,{className:"checkout-place-order__button","data-testid":"place-order-button",disabled:n,size:"medium",type:"button",variant:"primary",onClick:i,children:e},"placeOrder")}),M=b(w,q),se=({disabled:e=!1,active:o=!0,handleValidation:n,handlePlaceOrder:i,slots:l,...S})=>{var h;const[T,R]=C(!1),[_,E]=C(!1),y=K.value,d=L({CheckoutUnexpectedError:"Checkout.ServerError.unexpected",placeOrderButton:"Checkout.PlaceOrder.button"}),N=m(t=>{const r=B(t),a=r===p.UNKNOWN_ERROR?d.CheckoutUnexpectedError:t.message;u.emit("checkout/error",{message:a,code:r})},[d]),P=m(async()=>{var t;try{if(n&&!n())return;await i({cartId:U.cartId,quoteId:U.quoteId,code:((t=k("selectedPaymentMethod"))==null?void 0:t.code)??""})}catch(r){N(r)}},[n,i,N]),c=m(t=>{(!t||"isEmpty"in t&&t.isEmpty)&&E(!1)},[]);return f(()=>{if(o===!1)return;const t=u.on("cart/initialized",r=>{const a=(r==null?void 0:r.items)||[];E(a.some(O=>O.outOfStock||O.insufficientQuantity))},{eager:!0});return()=>{t==null||t.off()}},[o]),f(()=>{if(!o)return;const t=H();if(t){R(!0),c(t);return}const r=u.on("checkout/initialized",a=>{R(!0),c(a)},{eager:!0});return()=>{r==null||r.off()}},[o,c]),f(()=>{if(!o)return;const t=u.on("checkout/updated",r=>{c(r)},{eager:!1});return()=>{t==null||t.off()}},[o,c]),s(M,{...S,disabled:e||_||y,initialized:T,visible:o,onClick:P,children:s(W,{context:{code:((h=k("selectedPaymentMethod"))==null?void 0:h.code)??""},name:"Content",slot:l==null?void 0:l.Content,children:d.placeOrderButton})})};export{se as PlaceOrder,se as default};
//# sourceMappingURL=PlaceOrder.js.map
