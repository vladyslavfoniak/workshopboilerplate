/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as b,jsx as t}from"@dropins/tools/preact-jsx-runtime.js";import{h as Y,s as ee}from"../chunks/fetch-graphql.js";import{classes as L,VComponent as te,Slot as A}from"@dropins/tools/lib.js";import{i as ne}from"../chunks/events2.js";import{h as oe,g as re}from"../chunks/events.js";import{n as ae,g as x}from"../chunks/values.js";import{events as R}from"@dropins/tools/event-bus.js";import{s as ce}from"../chunks/setPaymentMethod.js";import{W as se}from"../chunks/ConditionalWrapper.js";/* empty css                      */import{Skeleton as ie,SkeletonRow as E,IllustratedMessage as me,Icon as Z,InLineAlert as le,ToggleButton as de,RadioButton as ue}from"@dropins/tools/components.js";import{s as he}from"../chunks/dom.js";import*as T from"@dropins/tools/preact-compat.js";import{useRef as pe,useEffect as fe}from"@dropins/tools/preact-compat.js";import{useText as $}from"@dropins/tools/i18n.js";import{useState as _,useCallback as P,useEffect as D,useMemo as ye}from"@dropins/tools/preact-hooks.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../fragments.js";import"../chunks/guards.js";import"../chunks/synchronizeCheckout.js";import"../chunks/transform-shipping-methods.js";const ke=n=>T.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.93 14.8V18.75H5.97C4.75 18.75 3.75 17.97 3.75 17V6.5M3.75 6.5C3.75 5.53 4.74 4.75 5.97 4.75H15.94V8.25H5.97C4.75 8.25 3.75 7.47 3.75 6.5Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.35 11.64H14.04V14.81H19.35V11.64Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),T.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M17.9304 11.64V8.25H15.1504",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ge=()=>b(ie,{"data-testid":"payment-methods-skeleton",children:[t(E,{size:"medium",variant:"heading"}),t(E,{size:"medium",variant:"empty"}),t(E,{fullWidth:!0,size:"xlarge"}),t(E,{fullWidth:!0,size:"xlarge"})]}),ve=({UIComponentType:n="ToggleButton",busy:r,code:i,icon:h,onSelectionChange:o,selected:a,title:m})=>{const p={busy:r,className:"checkout-payment-methods__method",label:m,name:"payment-method",onChange:()=>o({code:i,title:m}),value:i};return n==="ToggleButton"?t(de,{...p,icon:h?t(Z,{source:h}):void 0,selected:a}):t(ue,{...p,checked:a,icon:h??void 0})},Me=({className:n,error:r=null,busy:i=!1,onDismissError:h,onSelectionChange:o=()=>{},options:a,paymentMethodContent:m,selection:p,title:g,UIComponentType:w})=>{const C=$({EmptyState:"Checkout.PaymentMethods.emptyState"}),k=r!==null,v=pe(null);return fe(()=>{k&&v.current&&he(v.current)},[k]),b("div",{className:L(["checkout-payment-methods",n]),"data-testid":"checkout-payment-methods",children:[g&&t(te,{className:"checkout-payment-methods__title",node:g}),!i&&a.length===0&&t(me,{"data-testid":"checkout-payment-methods-empty",icon:t(Z,{source:ke}),message:t("p",{children:C.EmptyState})}),b("div",{className:L(["checkout-payment-methods__wrapper",["checkout-payment-methods__wrapper--busy",i]]),"data-testid":"checkout-payment-methods-wrapper",children:[t("div",{className:L(["checkout-payment-methods__methods",["checkout-payment-methods--full-width",a.length%2!==0]]),children:a==null?void 0:a.map(f=>t(ve,{UIComponentType:w,busy:i,code:f.code,icon:f.icon,selected:(p==null?void 0:p.code)===f.code,title:f.displayLabel??!0?f.title:"",onSelectionChange:o},f.code))}),m&&t("div",{className:"checkout-payment-methods__content",children:m})]}),k&&t("div",{ref:v,className:"checkout-payment-methods__error","data-testid":"checkout-payment-methods-alert",children:t(le,{heading:r,type:"error",variant:"primary",onDismiss:h})})]})},Se=se(Me,ge);function W(n,r){return n?r.some(i=>i.code===n.code):!1}function Pe(n,r){return!n||!r?!1:n.code===r.code}function Ce(n){return n?!!n.code&&!!n.title:!1}const $e=({UIComponentType:n="ToggleButton",active:r=!0,autoSync:i=!0,displayTitle:h=!0,slots:o,onCartSyncError:a,onSelectionChange:m})=>{var N,O;const[p,g]=_(null),[w,C]=_(!1),[k,v]=_(null),[f,z]=_([]),l=o==null?void 0:o.Methods,q=Y.value,F=f.filter(e=>{var c;return((c=l==null?void 0:l[e.code])==null?void 0:c.enabled)!==!1}).map(e=>{const c=(l==null?void 0:l[e.code])||{};return{...e,...c}}),{cartSyncError:H,defaultTitle:B}=$({cartSyncError:"Checkout.PaymentMethods.cartSyncError",defaultTitle:"Checkout.PaymentMethods.title"}),G=P(()=>{g(null)},[]),u=P(e=>{g(null),v(e),ae({selectedPaymentMethod:e})},[]),M=P(async(e,c)=>{if(!(ne()||oe()))return;const d=l==null?void 0:l[e.code];((d==null?void 0:d.autoSync)??i)&&ce({code:e.code}).catch(y=>{u(c??null),a==null||a({method:e,error:y}),a||g(H)})},[l,i,u,a,H]),J=P(async e=>{const c=x("selectedPaymentMethod");u(e),m==null||m(e),await M(e,c)},[m,u,M]),S=P(e=>{if(!e||e.isEmpty){u(null),z([]);return}const s=e.availablePaymentMethods??[];if(z(s),s.length===0){u(null);return}const d=e.selectedPaymentMethod??null,V=Ce(d),y=x("selectedPaymentMethod"),U=W(y,s),X=Pe(y,d);if(y&&U&&!X){M(y,d);return}if((!y||!U)&&V&&W(d,s)){u(d);return}if((!y||!U)&&(!V||!W(d,s))){const j=s[0];u(j),M(j)}},[u,M]);D(()=>{if(!r)return;const e=re();if(e){C(!0);const s=x("selectedPaymentMethod");s&&v(s),S(e);return}const c=R.on("checkout/initialized",s=>{C(!0),S(s)},{eager:!0});return()=>{c==null||c.off()}},[r,S]),D(()=>{if(!r)return;const e=R.on("checkout/updated",S,{eager:!1});return()=>{e==null||e.off()}},[r,S]);const I=k?(O=(N=o==null?void 0:o.Methods)==null?void 0:N[k.code])==null?void 0:O.render:null,K=I?t(A,{context:{cartId:ee.cartId??"",replaceHTML(e){this.replaceWith(e)}},name:"PaymentMethodContent",slot:I},I):void 0,Q=ye(()=>{if(h)return t(A,{name:"checkout-payment-methods-title",slot:o==null?void 0:o.Title,children:t("h2",{children:B})})},[h,o==null?void 0:o.Title,B]);return t(Se,{UIComponentType:n,busy:q,error:p,initialized:w,options:F,paymentMethodContent:K,selection:k,title:Q,visible:r,onDismissError:G,onSelectionChange:J})};export{$e as PaymentMethods,$e as default};
//# sourceMappingURL=PaymentMethods.js.map
